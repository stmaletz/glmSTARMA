% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/glmstarma.R
\name{glmstarma}
\alias{glmstarma}
\title{Fit STARMA Models based on generalized linear models}
\usage{
glmstarma(
  ts,
  model = list(),
  wlist,
  family = NULL,
  covariates = NULL,
  wlist_past_mean = NULL,
  wlist_covariates = NULL,
  control = list()
)
}
\arguments{
\item{ts}{Multivariate time-series. Rows indicate the locations and columns the time.}

\item{model}{a named list specifying the model orders of the linear predictor, which can be of the following elements:
\itemize{
\item \code{intercept} : (Optional) character
\itemize{
\item \code{'homogenous'} (default) for a homogenous model, i.e. the same intercept for all components
\item \code{'inhomogenous'} for inhomogenous models, i.e. fitting an individual intercept for each component
}
\item \code{past_obs} :
\itemize{
\item Integer vector with the maximal spatial orders for the time lags in \code{past_obs_time_lags}.
\item Alternatively: a binary matrix, with the entry in row \eqn{i} and column \eqn{j} indicating whether the \eqn{(i - 1)}-spatial lag for the \eqn{j}-th time lag is included in the model.
}
\item \code{past_obs_time_lags} : (Optional) integer vector
\itemize{
\item indicates the time lags for \code{past_obs}. Defaults to \code{seq(length(past_obs))} (for vectors) and \code{seq(ncol(past_obs))} (for a matrix)
}
\item \code{past_mean} : (Optional)
\itemize{
\item Spatial orders for the regression on past values of (latent) linear process values.
\item Values can be entered in the same format as in \code{past_obs}. If not specified, no regression to the feedback process is performed.
}
\item \code{past_mean_time_lags} : (Optional) integer vector
\itemize{
\item Time lags for the regression on the (latent) linear process. Values can be entered in the same format as in \code{past_obs_time_lags}.
}
\item \code{covariates} : (Optional)
\itemize{
\item spatial orders for the covariate processes passed in the argument \code{covariates}. The values can be passed as in \code{past_obs} and \code{past_means}, where the \eqn{j}-th entry or column represents the \eqn{j}-th covariate.
\item Default is spatial order 0 for all covariates, which corresponds to the first matrix in argument \code{wlist_covariates}.
}
}}

\item{wlist}{A list of quadratic matrices, with the same dimension as the time series has rows, which describe the spatial dependencies. Row-normalized matrices are recommended. See Details.}

\item{family}{A list generated by one of the family functions of this package \code{\link{stfamily}}. This argument specifies the marginal distributions and the type of model fitted.}

\item{covariates}{(Potentially named) list of covariates, containing matrices of same dimension as \code{ts} or returns of the covariate functions of this package (see \code{\link{TimeConstant}}, \code{\link{SpatialConstant}}).}

\item{wlist_past_mean}{(Optional) List of matrices, which describes spatial dependencies for the values of the linear predictor. If this is \code{NULL}, the matrices from \code{wlist} are used.}

\item{wlist_covariates}{(Optional) List of matrices, which describes spatial dependencies for the covariates. If this is \code{NULL}, the matrices from \code{wlist} are used.}

\item{control}{A list of parameters for controlling the fitting process. This list is passed to \code{\link{glmstarma.control}}.}
}
\value{
The function returns an object of class \code{glmstarma}, which contains beside the (maybe revised) input to the function:
\itemize{
\item \code{target_dim} Number of locations. Corresponds to the number of rows in \code{ts}.
\item \code{n_obs_effective} Effective number of observation times. Corresponds to the number of columns in \code{ts} minus the maximum time lag of the model.
\item \code{max_time_lag} Maximum time lag in the model.
\item \code{log_likelihood} The (quasi)-log-likelihood of the fitted model, which is based on \code{n_obs_effective} observation times.
\item \code{score} The (quasi)-score vector at the quasi maximum likelihood estimation.
\item \code{information} The (quasi)-information matrix at the quasi maximum likelihood estimation.
\item \code{variance_estimation} The variance estimation of the parameter estimates. Calculated based on a sandwich estimator.
\item \code{aic} AIC of the model based on the quasi log-likelihood, see \link{information_criteria}.
\item \code{bic} BIC of the model based on the quasi log-likelihood, see \link{information_criteria}.
\item \code{qic} QIC of the model based on the quasi log-likelihood, see \link{QIC}.
\item \code{design_matrix} The final design matrix of the model
\item \code{derivatives} The derivatives of the linear predictor with respect to the parameters at each time point.
\item \code{fitted.values} The fitted values of the model, which can be extracted by the \code{\link{fitted}} method.
\item \code{link_values} Fitted values of the linear process, i.e. \eqn{\mathbf{\psi}_t}.
\item \code{algorithm} Information about the fitting method.
\item \code{convergence} A named list with information about the convergence of the optimization:
\itemize{
\item \code{start} The values used for the coefficients at the start of the estimation.
\item \code{fncount} Number of calls of the quasi-loglikelihood during optimization.
\item \code{grcount} Number of calls of the quasi-score during optimization.
\item \code{hecount} Number of calls of the quasi-information during optimization. In algorithms not using the information, this is 0 or the number how often constrains are evaluated.
\item \code{fitting_time} The time in milliseconds it took to estimate the model.
\item \code{convergence} Logical value indicating the convergence of the algorithm.
\item \code{message} An optional message by the optimization algorithm.
}
\item \code{call} The function call.
}
}
\description{
The function \code{glmstarma} estimates a multivariate time series model based on generalised linear models (GLM). The primary application is for spatio-temporal data, but different applications, like time-varying network data can be ttacked by this methodology.
The model framework links the mean of the time series conditional on the past, to a linear predictor. This linear predictor allows regression on past observations, past values of the linear predictor and covariates, as described in the details.
Various distributions with several link-functions are available.
}
\details{
For the time series \eqn{\{Y_t = (Y_{1,t}, \ldots, Y_{p,t})'\}}, we assume that the (marginal) conditional components \eqn{Y_{i,t} \mid \mathcal{F}_{t-1}} follow a distribution that is a member of the exponential family. The term \eqn{\mathcal{F}_{t-1}} denotes the history of the process up to time \eqn{t-1}.
The multivariate distribution of \eqn{Y_t \mid \mathcal{F}_{t-1}} is not necessarily identifiable. The conditional expected value \eqn{\mathbf{\mu}_t := \mathbb{E}(Y_t \mid \mathcal{F}_{t-1})} is connected to the linear process by the link-function, i.e. \eqn{g(\mathbf{\mu}_t) = \mathbf{\psi}_t}, which is applied elementwise.
The linear process has the following structure:
\deqn{\mathbf{\psi}_t = \mathbf{\delta} + \sum_{i = 1}^{q} \sum_{\ell = 0}^{a_i} \alpha_{i, \ell} W_{\alpha}^{(\ell)} h(\mathbf{\psi}_{t - i}) + \sum_{j = 1}^{r} \sum_{\ell = 0}^{b_j} \beta_{j, \ell} W_{\beta}^{(\ell)} \tilde{h}(\mathbf{Y}_{t - j}) + \sum_{k = 1}^{m} \sum_{\ell = 0}^{c_k} \gamma_{k, \ell} W_{\gamma}^{(\ell)} \mathbf{X}_{k, t},}
where the matrices \eqn{W_{\alpha}^{(\ell)}}, \eqn{W_{\beta}^{(\ell)}}, and \eqn{W_{\gamma}^{(\ell)}} are taken from the lists \code{wlist_past_mean}, \code{wlist}, and \code{wlist_covariates}, respectively, and \eqn{\ell} denotes the spatial order.
If \eqn{\delta = \delta_0 \mathbf{1}} with a scalar \eqn{\delta_0}, the model is called homogenous with respect to the intercept; otherwise, it is inhomogenous.
Spatial orders, intercept structure and deviating time lags are specified in the argument \code{model}. If \code{past_mean} is specified, it is also required that \code{past_mean} is specified for identifiability.

The functions \eqn{h} and \eqn{\tilde{h}} are set internally with the \code{family} argument. In nearly all cases, \eqn{h} corresponds to the identity function, i.e. \eqn{h(\mathbf{\psi}_{t - i}) = \mathbf{\psi}_{t - i}}, and \eqn{\tilde{h}} is similar to the link-function.
Using count data as an example, for \code{family = vpoisson("identity")} and \code{family = vpoisson("log")} result in the linear and log-linear Poisson STARMA models from Maletz et al. (2024), where \code{vpoisson("softplus")} results in the approximately linear model by Jahn et al. (2023).

The unknown parameters \eqn{\delta}, \eqn{\alpha_{i, \ell}}, \eqn{\beta_{j, \ell}}, and \eqn{\gamma_{k, \ell}} are estimated by quasi-maximum likelihood estimation, assuming conditional independence of the components given the past for calculating the quasi-likelihood.
Parameter estimation is by default performed under stability constraints to ensure stability of the model. These constraints can be modified or deactivated via the \code{control} argument. See \code{\link{glmstarma.control}} for details.
}
\examples{
dat <- load_data("chickenpox")
chickenpox <- dat$chickenpox
population_hungary <- dat$population_hungary
W_hungary <- dat$W_hungary

model_autoregressive <- list(intercept = "homogeneous", past_obs = rep(1, 7))
glmstarma(chickenpox, model_autoregressive, W_hungary, family = vpoisson("log"), 
          covariates = list(population = population_hungary), 
          control = list(parameter_init = "zero"))
delete_glmSTARMA_data("chickenpox")  # Clean up cached data
}
\references{
\itemize{
\item Cliff, A. D., & Ord, J. K. (1975). Space-Time Modelling with an Application to Regional Forecasting. Transactions of the Institute of British Geographers, 64, 119–128. \doi{10.2307/621469}
\item Jahn, M., Weiß, C.H., & Kim, H., (2023), Approximately linear INGARCH models for spatio-temporal counts, \emph{Journal of the Royal Statistical Society Series C: Applied Statistics}, 72(2), 476–497, \doi{10.1093/jrsssc/qlad018}
\item Maletz, S., Fokianos, K., & Fried, R. (2024). Spatio-Temporal Count Autoregression. \emph{Data Science in Science}, 3(1), \doi{10.1080/26941899.2024.2425171}
\item Pfeifer, P. E., & Deutsch, S. J. (1980). A Three-Stage Iterative Procedure for Space-Time Modeling Phillip. Technometrics, 22(1), 35–47. \doi{10.2307/1268381}
}
}
\seealso{
\code{\link{stfamily}}, \code{\link{glmstarma.control}}, \code{\link{dglmstarma}}, \code{\link{TimeConstant}}, \code{\link{SpatialConstant}}
}
